var FWD;FWD=function(){function a(){}return a.init=function(a){return this.devKey=a},a.getDevKey=function(){return this.devKey||function(){throw"FWD DevKey required."}()},a}(),FWD.URL=function(){function a(){}return a.host="https://app.fwd.us/api/v1",a.urls={companies:{index:"/companies.json"},stories:{search:"/stories/search.json"},articles:{press:"/articles/press.json"}},a["for"]=function(a){var b,c,d,e;return e=a.split("#"),c=e[0],b=e[1],d=this.urls[c][b],this.host.concat(d)},a}(),FWD.Helpers=function(){function a(){}return a.arrayParam=function(a){return $.isArray(a)?a.join(","):a},a}();var bind=function(a,b){return function(){return a.apply(b,arguments)}};FWD.Model=function(){function a(a){this.attributes=a,this.set=bind(this.set,this),this.get=bind(this.get,this)}return a.prototype.get=function(a){return this.attributes[a]},a.prototype.set=function(a,b){return this.attributes[a]=b},a}(),FWD.Api=function(){function a(){}return a.get=function(a,b){return b=$.extend({key:FWD.getDevKey()},b),$.getJSON(a,b)},a.getAllPages=function(b,c,d){return $.Deferred(function(e){var f,g;return d=$.extend({},d,{page:1,per_page:100}),f=[],g=function(h){var i;return f=f.concat(h[c]),i=h.page,i<h.total_pages?(d.page=i+1,a.get(b,d).fail(e.reject).done(g)):e.resolve(f)},a.get(b,d).fail(e.reject).done(g)}).promise()},a}();var extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;FWD.Article=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.press=function(a){return null==a&&(a={}),(new FWD.PressLoader).load(a)},b}(FWD.Model);var extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;FWD.Company=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.companies=null,b.loadAll=function(){return b.loadAllDeferred||(b.loadAllDeferred=$.Deferred(function(a){var c;return c=new FWD.CompanyLoader,c.loadAll().fail(a.reject).done(function(c){return b.companies=c,a.resolve(b.companies)})}).promise()),b.loadAllDeferred},b.find=function(a){return $.Deferred(function(c){return b.loadAll().fail(c.reject).done(function(){var d,e,f,g;for(g=b.companies,e=0,f=g.length;f>e;e++)if(d=g[e],d.get("id")===a)return void c.resolve(d);return c.reject()})}).promise()},b}(FWD.Model);var bind=function(a,b){return function(){return a.apply(b,arguments)}};FWD.CompanyLoader=function(){function a(){this._buildCompanies=bind(this._buildCompanies,this),this.loadAll=bind(this.loadAll,this)}return a.prototype.url=FWD.URL["for"]("companies#index"),a.prototype.loadAll=function(){return $.Deferred(function(a){return function(b){return FWD.Api.getAllPages(a.url,"companies",{}).fail(b.reject).done(function(c){var d;return d=a._buildCompanies(c),b.resolve(d)})}}(this)).promise()},a.prototype._buildCompanies=function(a){return $.map(a,function(a){return new FWD.Company(a)})},a}();var bind=function(a,b){return function(){return a.apply(b,arguments)}};FWD.PressLoader=function(){function a(){this._buildModels=bind(this._buildModels,this),this._filterParamAdapter=bind(this._filterParamAdapter,this),this.load=bind(this.load,this)}return a.prototype.url=FWD.URL["for"]("articles#press"),a.prototype.load=function(a){return $.Deferred(function(b){return function(c){var d;return d=b._filterParamAdapter(a),FWD.Api.get(b.url,d).fail(c.reject).done(function(a){var d;return d=b._buildModels(a.articles),c.resolve(d)})}}(this)).promise()},a.prototype._filterParamAdapter=function(a){return a=$.extend({},a),a.tags=FWD.Helpers.arrayParam(a.tags),a},a.prototype._buildModels=function(a){return $.map(a,function(a){return new FWD.Article(a)})},a}();var bind=function(a,b){return function(){return a.apply(b,arguments)}},extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;FWD.Story=function(a){function b(){return this.company=bind(this.company,this),b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.search=function(a){return(new FWD.StorySearch).search(a)},b.searchAll=function(a){return null==a&&(a={}),(new FWD.StorySearch).searchAll(a)},b.prototype.company=function(){return $.Deferred(function(a){return function(b){return a.get("company_id")?FWD.Company.find(a.get("company_id")).then(b.resolve,b.reject):b.reject()}}(this)).promise()},b}(FWD.Model);var bind=function(a,b){return function(){return a.apply(b,arguments)}};FWD.StorySearch=function(){function a(){this._buildStories=bind(this._buildStories,this),this._filterParamAdapter=bind(this._filterParamAdapter,this),this.searchAll=bind(this.searchAll,this),this.search=bind(this.search,this)}return a.prototype.url=FWD.URL["for"]("stories#search"),a.prototype.search=function(a){return $.Deferred(function(b){return function(c){var d;return d=$.extend({per_page:100},b._filterParamAdapter(a)),FWD.Api.get(b.url,d).fail(c.reject).done(function(a){var d;return d=b._buildStories(a.stories),c.resolve(d)})}}(this)).promise()},a.prototype.searchAll=function(a){return $.Deferred(function(b){return function(c){var d;return d=FWD.Api.getAllPages(b.url,"stories",b._filterParamAdapter(a)),d.fail(c.reject).done(function(a){var d;return d=b._buildStories(a),c.resolve(d)})}}(this)).promise()},a.prototype._filterParamAdapter=function(a){var b;return b=$.extend({},a),b.company=this._arrayParam(b.company),b.tags=this._arrayParam(b.tags),b},a.prototype._buildStories=function(a){return $.map(a,function(a){return new FWD.Story(a)})},a.prototype._arrayParam=FWD.Helpers.arrayParam,a}();